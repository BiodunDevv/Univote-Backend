<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Test - Univote</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .tab-container {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e0e0e0;
      }

      .tab {
        padding: 12px 24px;
        background: none;
        border: none;
        font-size: 16px;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        position: relative;
        transition: color 0.3s;
      }

      .tab:hover {
        color: #667eea;
      }

      .tab.active {
        color: #667eea;
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 2px;
        background: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .auth-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 5px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
      }

      .output {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border-radius: 5px;
        overflow-x: auto;
        margin-top: 20px;
        max-height: 600px;
        overflow-y: auto;
      }

      .output pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .stat-card h3 {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .stat-card p {
        opacity: 0.9;
        font-size: 0.9em;
      }

      .info-box {
        background: #d1ecf1;
        border-left: 4px solid #0c5460;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
      }

      .info-box strong {
        display: block;
        margin-bottom: 5px;
        color: #0c5460;
      }

      .success-box {
        background: #d4edda;
        border-left: 4px solid #155724;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
        color: #155724;
      }

      .error-box {
        background: #f8d7da;
        border-left: 4px solid #721c24;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
        color: #721c24;
      }

      .dashboard-data {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .data-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #e0e0e0;
      }

      .data-section h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .data-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .data-item:last-child {
        border-bottom: none;
      }

      .data-label {
        font-weight: 600;
        color: #555;
      }

      .data-value {
        color: #333;
      }

      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìä Dashboard API Test</h1>
        <p>Test the Univote Dashboard endpoints</p>
      </div>

      <div class="content">
        <!-- Tab Navigation -->
        <div class="tab-container">
          <button class="tab active" onclick="switchTab('admin')">
            Admin Dashboard
          </button>
          <button class="tab" onclick="switchTab('student')">
            Student Dashboard
          </button>
          <button class="tab" onclick="switchTab('quick')">Quick Stats</button>
          <button class="tab" onclick="switchTab('cache')">
            Cache Management
          </button>
        </div>

        <!-- Admin Dashboard Tab -->
        <div id="admin-tab" class="tab-content active">
          <h2>üîê Admin Dashboard</h2>

          <div class="auth-section">
            <h3>Authentication</h3>
            <div class="form-group">
              <label>API Base URL:</label>
              <input
                type="text"
                id="admin-base-url"
                value="http://localhost:5000"
              />
            </div>
            <div class="form-group">
              <label>Admin Email:</label>
              <input
                type="email"
                id="admin-email"
                value="admin@univote.com"
                placeholder="admin@univote.com"
              />
            </div>
            <div class="form-group">
              <label>Password:</label>
              <input
                type="password"
                id="admin-password"
                value="admin123"
                placeholder="Enter password"
              />
            </div>
            <button class="btn btn-primary" onclick="adminLogin()">
              üîë Login
            </button>
            <button class="btn btn-secondary" onclick="clearAdminToken()">
              üö™ Logout
            </button>
          </div>

          <div class="info-box">
            <strong>Admin Token Status:</strong>
            <code id="admin-token-status">Not logged in</code>
          </div>

          <h3>Dashboard Actions</h3>
          <button class="btn btn-success" onclick="getAdminDashboard()">
            üìä Get Admin Dashboard
          </button>
          <button class="btn btn-primary" onclick="getQuickStats('admin')">
            ‚ö° Get Quick Stats
          </button>

          <div id="admin-output" class="output" style="display: none">
            <pre id="admin-result"></pre>
          </div>
        </div>

        <!-- Student Dashboard Tab -->
        <div id="student-tab" class="tab-content">
          <h2>üë®‚Äçüéì Student Dashboard</h2>

          <div class="auth-section">
            <h3>Authentication</h3>
            <div class="form-group">
              <label>API Base URL:</label>
              <input
                type="text"
                id="student-base-url"
                value="http://localhost:5000"
              />
            </div>
            <div class="form-group">
              <label>Matric Number:</label>
              <input
                type="text"
                id="student-matric"
                value="BU22CSC1001"
                placeholder="BU22CSC1001"
              />
            </div>
            <div class="form-group">
              <label>Password:</label>
              <input
                type="password"
                id="student-password"
                value="password123"
                placeholder="Enter password"
              />
            </div>
            <button class="btn btn-primary" onclick="studentLogin()">
              üîë Login
            </button>
            <button class="btn btn-secondary" onclick="clearStudentToken()">
              üö™ Logout
            </button>
          </div>

          <div class="info-box">
            <strong>Student Token Status:</strong>
            <code id="student-token-status">Not logged in</code>
          </div>

          <h3>Dashboard Actions</h3>
          <button class="btn btn-success" onclick="getStudentDashboard()">
            üìä Get Student Dashboard
          </button>
          <button class="btn btn-primary" onclick="getQuickStats('student')">
            ‚ö° Get Quick Stats
          </button>

          <div id="student-output" class="output" style="display: none">
            <pre id="student-result"></pre>
          </div>
        </div>

        <!-- Quick Stats Tab -->
        <div id="quick-tab" class="tab-content">
          <h2>‚ö° Quick Statistics</h2>

          <div class="info-box">
            <strong>Note:</strong> This endpoint works for both admin and
            student. Make sure you're logged in as either admin or student
            first.
          </div>

          <button class="btn btn-primary" onclick="getQuickStats('auto')">
            ‚ö° Get Quick Stats (Auto-detect)
          </button>

          <div id="quick-output" class="output" style="display: none">
            <pre id="quick-result"></pre>
          </div>
        </div>

        <!-- Cache Management Tab -->
        <div id="cache-tab" class="tab-content">
          <h2>üóëÔ∏è Cache Management</h2>

          <div class="info-box">
            <strong>Dashboard Caching:</strong>
            The dashboard data is cached to improve performance:
            <ul style="margin-top: 10px">
              <li>Admin dashboard: 5 minutes</li>
              <li>Student dashboard: 2 minutes</li>
              <li>Quick stats: 1 minute</li>
            </ul>
          </div>

          <h3>Invalidate Cache</h3>
          <p>
            Clear the cached dashboard data for the current user (requires
            login).
          </p>

          <button class="btn btn-danger" onclick="invalidateCache('admin')">
            üóëÔ∏è Invalidate Admin Cache
          </button>
          <button class="btn btn-danger" onclick="invalidateCache('student')">
            üóëÔ∏è Invalidate Student Cache
          </button>

          <div id="cache-output" class="output" style="display: none">
            <pre id="cache-result"></pre>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Token storage
      let adminToken = localStorage.getItem("admin_token") || "";
      let studentToken = localStorage.getItem("student_token") || "";

      // Update token status on load
      updateTokenStatus();

      function switchTab(tabName) {
        // Hide all tabs
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Remove active class from all tab buttons
        document.querySelectorAll(".tab").forEach((btn) => {
          btn.classList.remove("active");
        });

        // Show selected tab
        document.getElementById(`${tabName}-tab`).classList.add("active");

        // Add active class to clicked tab button
        event.target.classList.add("active");
      }

      function updateTokenStatus() {
        const adminStatus = document.getElementById("admin-token-status");
        const studentStatus = document.getElementById("student-token-status");

        if (adminToken) {
          adminStatus.textContent = `Logged in (Token: ${adminToken.substring(
            0,
            20
          )}...)`;
          adminStatus.style.color = "#28a745";
        } else {
          adminStatus.textContent = "Not logged in";
          adminStatus.style.color = "#dc3545";
        }

        if (studentToken) {
          studentStatus.textContent = `Logged in (Token: ${studentToken.substring(
            0,
            20
          )}...)`;
          studentStatus.style.color = "#28a745";
        } else {
          studentStatus.textContent = "Not logged in";
          studentStatus.style.color = "#dc3545";
        }
      }

      async function adminLogin() {
        const baseUrl = document.getElementById("admin-base-url").value;
        const email = document.getElementById("admin-email").value;
        const password = document.getElementById("admin-password").value;

        try {
          const response = await fetch(`${baseUrl}/api/auth/admin-login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (response.ok) {
            adminToken = data.token;
            localStorage.setItem("admin_token", adminToken);
            updateTokenStatus();
            showResult("admin", data, true);
          } else {
            showResult("admin", data, false);
          }
        } catch (error) {
          showResult("admin", { error: error.message }, false);
        }
      }

      async function studentLogin() {
        const baseUrl = document.getElementById("student-base-url").value;
        const matric_no = document.getElementById("student-matric").value;
        const password = document.getElementById("student-password").value;

        try {
          const response = await fetch(`${baseUrl}/api/auth/login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ matric_no, password }),
          });

          const data = await response.json();

          if (response.ok) {
            studentToken = data.token;
            localStorage.setItem("student_token", studentToken);
            updateTokenStatus();
            showResult("student", data, true);
          } else {
            showResult("student", data, false);
          }
        } catch (error) {
          showResult("student", { error: error.message }, false);
        }
      }

      function clearAdminToken() {
        adminToken = "";
        localStorage.removeItem("admin_token");
        updateTokenStatus();
        showResult("admin", { message: "Logged out successfully" }, true);
      }

      function clearStudentToken() {
        studentToken = "";
        localStorage.removeItem("student_token");
        updateTokenStatus();
        showResult("student", { message: "Logged out successfully" }, true);
      }

      async function getAdminDashboard() {
        if (!adminToken) {
          alert("Please login as admin first!");
          return;
        }

        const baseUrl = document.getElementById("admin-base-url").value;

        try {
          const response = await fetch(`${baseUrl}/api/dashboard/admin`, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${adminToken}`,
            },
          });

          const data = await response.json();
          showResult("admin", data, response.ok);
        } catch (error) {
          showResult("admin", { error: error.message }, false);
        }
      }

      async function getStudentDashboard() {
        if (!studentToken) {
          alert("Please login as student first!");
          return;
        }

        const baseUrl = document.getElementById("student-base-url").value;

        try {
          const response = await fetch(`${baseUrl}/api/dashboard/student`, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${studentToken}`,
            },
          });

          const data = await response.json();
          showResult("student", data, response.ok);
        } catch (error) {
          showResult("student", { error: error.message }, false);
        }
      }

      async function getQuickStats(type) {
        let token = "";
        let baseUrl = "";

        if (type === "admin") {
          if (!adminToken) {
            alert("Please login as admin first!");
            return;
          }
          token = adminToken;
          baseUrl = document.getElementById("admin-base-url").value;
        } else if (type === "student") {
          if (!studentToken) {
            alert("Please login as student first!");
            return;
          }
          token = studentToken;
          baseUrl = document.getElementById("student-base-url").value;
        } else {
          // Auto-detect
          if (adminToken) {
            token = adminToken;
            baseUrl = document.getElementById("admin-base-url").value;
          } else if (studentToken) {
            token = studentToken;
            baseUrl = document.getElementById("student-base-url").value;
          } else {
            alert("Please login as admin or student first!");
            return;
          }
        }

        try {
          const response = await fetch(`${baseUrl}/api/dashboard/stats`, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          const data = await response.json();
          showResult(type === "auto" ? "quick" : type, data, response.ok);
        } catch (error) {
          showResult(
            type === "auto" ? "quick" : type,
            { error: error.message },
            false
          );
        }
      }

      async function invalidateCache(type) {
        let token = "";
        let baseUrl = "";

        if (type === "admin") {
          if (!adminToken) {
            alert("Please login as admin first!");
            return;
          }
          token = adminToken;
          baseUrl = document.getElementById("admin-base-url").value;
        } else {
          if (!studentToken) {
            alert("Please login as student first!");
            return;
          }
          token = studentToken;
          baseUrl = document.getElementById("student-base-url").value;
        }

        try {
          const response = await fetch(
            `${baseUrl}/api/dashboard/invalidate-cache`,
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          const data = await response.json();
          showResult("cache", data, response.ok);
        } catch (error) {
          showResult("cache", { error: error.message }, false);
        }
      }

      function showResult(section, data, success) {
        const outputDiv = document.getElementById(`${section}-output`);
        const resultPre = document.getElementById(`${section}-result`);

        outputDiv.style.display = "block";
        resultPre.textContent = JSON.stringify(data, null, 2);

        if (success) {
          outputDiv.style.borderLeft = "4px solid #28a745";
        } else {
          outputDiv.style.borderLeft = "4px solid #dc3545";
        }
      }
    </script>
  </body>
</html>
